python<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rekam Medis</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <!-- DataTables CSS -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css"
    />
    <!-- DataTables JS -->
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"
    ></script>
  </head>
  <script>
    // rekam medis
    $(document).ready(function () {
      // Inisialisasi datatables
      let rekam_medisTable = $("#rekam_medisTable").DataTable();
      let list_checkup_user = $("#list_checkup_user").DataTable();

      // Event listener for Submit button
      $("#rekam_medisTable").on("click", ".btn-buat", function (e) {
        let row = rekam_medisTable.row($(this).parents("tr"));
        let rowData = row.data();
        let nik = rowData[1];
        $("#buatrekam_medis")
          .off("submit")
          .submit(function (e) {
            e.preventDefault();

            // Ambil nilai input
            let no_kartu = $("#no_kartu").val();
            let dokter = $("#dokter").val();
            let hasil_anamnesa = $("#hasil_anamnesa").val();

            // Lakukan validasi
            // if (!no_kartu || !dokter || !hasil_anamnesa || !nik) {
            //   alert("Semua field harus diisi!");
            //   return;
            // }

            let formData = $(this).serializeArray();
            console.log("save");

            $.ajax({
              url: `/buat_rekam_medis/${nik}`,
              type: "POST",
              data: formData,
              success: function (response) {
                // // Update tabel
                // let newRow = [
                //   response.no_kartu,
                //   response.dokter,
                //   response.hasil_anamnesa,
                //   response.nik,
                //   "<button class='btn btn-warning btn-sm btn-edit' data-bs-toggle='modal'        data-bs-target='#editModal'>Edit</button> <button class='btn btn-danger btn-sm btn-delete' data-bs-toggle='modal' data-bs-target='#deleteModal'>Delete</button>",
                // ];
                // let rowNode = rekam_medisTable.row.add(newRow).draw().node();
                // $(rowNode).attr("id", response._id); // Set ID for the new row

                // // Reset the form
                // $("#buatrekam_medis")[0].reset();

                // // Close the modal
                // $("#buatModal").modal("hide");

                alert("Jadwal berhasil ditambahkan!");
                window.location.reload();
              },
              error: function (error) {
                console.log("Error:", error);
              },
            });
          });
      });

      // Event listener for Add button
      $("#rekam_medisTable").on("click", ".btn-lihat", function (e) {
        e.preventDefault();
        console.log("lihat");
        let row = rekam_medisTable.row($(this).parents("tr"));
        let rowData = row.data();
        console.log(rowData);
        let nik = rowData[1];

        $.ajax({
          url: `/lihat_rekam_medis/${nik}`,
          type: "GET",
          success: function (response) {
            // Update tabel
            console.log(response.list_checkup_user.length);
            list_checkup_user.clear().draw();
            for (let i = 0; i < response.list_checkup_user.length; i++) {
              let dokter = response.list_checkup_user[i].dokter || "Belum ada dokter";
              let hasil_anamnesa =
                response.list_checkup_user[i].hasil_anamnesa ||
                "Belum ada hasil anamnesa";
              let newRow = [
                i + 1,
                response.list_checkup_user[i].tgl_periksa,
                dokter,
                response.list_checkup_user[i].poli,
                response.list_checkup_user[i].keluhan,
                hasil_anamnesa,
                "<button class='btn btn-warning btn-sm btn-edit' data-bs-toggle='modal'        data-bs-target='#editModal'>Edit</button>",
              ];
              let rowNode = list_checkup_user.row.add(newRow).draw().node();
              $(rowNode).attr("id", response.list_checkup_user[i]._id);
            }
          },
          error: function (error) {
            console.log("Error:", error);
          },
        });
      });

      // Event listener for Edit buttons
      $("#list_checkup_user").on("click", ".btn-edit", function () {
        let action = $(this).text();
        let row = list_checkup_user.row($(this).parents("tr"));
        let rowData = row.data();
        let rowId = $(this).parents("tr").attr("id");
        let editModal = $("#editModal");
        console.log(rowData, row.id());
        $.ajax({
          url: "/api/get-edit_rekam_medis/" + rowId,
          type: "GET",
          success: function (response) {
            console.log(response);
            editModal.find("#dokter").val(response.dokter);
            editModal.find("#hasil_anamnesa").val(response.hasil_anamnesa);
          },
          error: function (error) {
            console.log("Error:", error);
          },
        });

        // Event listener for Edit form submission
        editModal
          .find("#edit")
          .off("submit")
          .submit(function (e) {
            e.preventDefault();

            // Ambil nilai input
            let dokter = editModal.find("#dokter").val();
            let hasil_anamnesa = editModal.find("#hasil_anamnesa").val();

            let formData = $(this).serializeArray();

            $.ajax({
              url: "/api/edit-rekam_medis/" + rowId,
              type: "POST",
              data: formData,
              success: function (response) {
                console.log(response);
                // // Update the row
                // row
                //   .data([
                //     rowData[0],
                //     response.tgl_periksa,
                //     response.dokter,
                //     response.poli,
                //     response.keluhan,
                //     response.hasil_anamnesa,
                //     "<button class='btn btn-warning btn-sm btn-edit' data-bs-toggle='modal'        data-bs-target='#editModal'>Edit</button>"
                //   ])
                //   .draw();

                // Reset the form
                editModal.find("#edit")[0].reset();

                // Close the modal
                editModal.modal("hide");

                alert("Jadwal berhasil diubah!");
              },
              error: function (error) {
                console.log("Error:", error);
              },
            });
          });
      });
    }),
      $(".navbar-toggler").on("click", function () {
        $(".navbar-collapse").toggleClass("show");
      });
    function sign_out() {
      $.removeCookie("mytoken", { path: "/" });
      alert("Logged out!");
      window.location.href = "/";
    }
  </script>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
      <a class="navbar-brand">Klinik Google</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/kelola_pendaftaran">Pendaftaran</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/dashboard">Dashboard</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link active" href="/rekam_medis">Rekam Medis</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="kelola_praktik">Kelola Praktek</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/profile">{{ user_info.username }}</a>
          </li>
          <li class="nav-item">
            <button class="btn btn-danger" onclick="sign_out()">Logout</button>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container mt-5">
      <h2 id="jadwal" class="text-center">Data Rekam Medis</h2>
      <h2 id="jadwal" class="text-center">Pasien Klinik Google</h2>
      <table class="table" id="rekam_medisTable">
        <thead>
          <tr>
            <th>Nama Pasien</th>
            <th>NIK</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data will be populated here -->
          {% for item in data_rekam_medis %}
          <tr id="{{ item._id }}">
            <td>{{ item.name }}</td>
            <td>{{ item.nik }}</td>
            <td>
              {% if item.action == 'buat' %}
              <button
                class="btn btn-warning btn-sm btn-buat"
                data-bs-toggle="modal"
                data-bs-target="#buatModal"
              >
                Buat
              </button>
              {% else %}
              <button
                class="btn btn-danger btn-sm btn-lihat"
                data-bs-toggle="modal"
                data-bs-target="#lihatModal"
              >
                Lihat
              </button>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Buat Modal -->
    <div
      class="modal fade"
      id="buatModal"
      tabindex="-1"
      aria-labelledby="buatModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="buatModalLabel">
              Tambah Data Rekam Medis
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="buatrekam_medis">
              <div class="row mb-3">
                <label
                  for="no"
                  class="col-sm-2 col-form-label col-form-label-sm"
                  >No
                </label>
                <div class="col-sm-10">
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="no"
                    name="no"
                  />
                </div>
              </div>
              <div class="row mb-3">
                <label
                  for="dokter"
                  class="col-sm-2 col-form-label col-form-label-sm"
                  >Dokter
                </label>
                <div class="col-sm-10">
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="dokter"
                    name="dokter"
                  />
                </div>
              </div>
              <div class="field">
                <label class="label" for="textarea-about">Hasil Anamnesa</label>

                <p class="control">
                  <textarea
                    id="textarea-about"
                    class="textarea"
                    placeholder="Introduce yourself"
                    cols="50"
                    ,
                    name="hasil_anamnesa"
                  >
                  </textarea>
                </p>
              </div>
              <div class="d-flex justify-content-center">
                <button
                  type="button"
                  class="btn btn-secondary me-2"
                  data-bs-dismiss="modal"
                >
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </form>
          </div>
          <div class="modal-footer"></div>
        </div>
      </div>
    </div>

    <!-- lihat Modal -->
    <div
      class="modal fade"
      id="lihatModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="lihatModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-fullscreen" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="lihatModalLabel">Hasil Periksa</h2>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <table class="table" id="list_checkup_user">
              <thead>
                <tr>
                  <th>No</th>
                  <th>Tgl Periksa</th>
                  <th>Dokter</th>
                  <th>Poli</th>
                  <th>Keluhan</th>
                  <th>Anamnesa Hasil Pemeriksaan</th>
                  <th>Action</th>
                </tr>
              </thead>
            </table>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- edit Modal -->
    <div
      class="modal fade"
      id="editModal"
      tabindex="-1"
      aria-labelledby="editModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="editModalLabel">
              Tambah Data Rekam Medis
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="edit">
              <div class="row mb-3">
                <label
                  for="dokter"
                  class="col-sm-2 col-form-label col-form-label-sm"
                  >Dokter
                </label>
                <div class="col-sm-10">
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="dokter"
                    name="dokter"
                  />
                </div>
              </div>
              <div class="field">
                <label class="label" for="textarea-about">Hasil Anamnesa</label>
                <p class="control">
                  <textarea
                    id="textarea-about"
                    class="textarea"
                    placeholder="Introduce yourself"
                    cols="45"
                    ,
                    name="hasil_anamnesa"
                  >
                  </textarea>
                </p>
              </div>
              <div class="d-flex justify-content-center">
                <button
                  type="button"
                  class="btn btn-secondary me-2"
                  data-bs-dismiss="modal"
                >
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </form>
          </div>
          <div class="modal-footer"></div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer text-center mt-5 py-3">
      <p>&copy; 2023 Klinik Google. All rights reserved.</p>
    </div>
  </body>
</html>
