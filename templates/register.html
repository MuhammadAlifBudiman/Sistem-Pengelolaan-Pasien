<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>

    <script>
      $(document).ready(function () {
        $("#registrationForm").submit(function (event) {
          // Validasi username
          const username = $("#username").val();
          if (!username) {
            alert("Username tidak boleh kosong");
            event.preventDefault();
            return;
          }else{
            console.log(username);
            $.ajax({
              url: "/api/check-username",
              type: "POST",
              data: {
                username: username,
              },
              success: function (response) {
                if (response.exists) {
                  alert("Username sudah digunakan");
                  event.preventDefault();
                  return;
                }
              },
            });
          }

          // Validasi nama
          const name = $("#name").val();
          if (!name) {
            alert("Nama tidak boleh kosong");
            event.preventDefault();
            return;
          }

          // Validasi NIK (16 digit)
          const nik = $("#nik").val();
          if (!nik) {
            alert("NIK tidak boleh kosong");
            event.preventDefault();
            return;
          }
          if (nik.length !== 16 || !/^\d+$/.test(nik)) {
            alert("NIK harus terdiri dari 16 digit angka");
            event.preventDefault();
            return;
          }

          // Validasi tanggal lahir
          const tglLahirInput = $("#tgl-lahir").val();
          if (!tglLahirInput) {
            alert("Tanggal lahir tidak boleh kosong");
            event.preventDefault();
            return;
          }

          const tglLahir = new Date(tglLahirInput);
          const today = new Date();

          if (tglLahir >= today) {
            alert("Tanggal lahir harus lebih kecil dari hari ini");
            event.preventDefault();
            return;
          }

          // Validasi jenis kelamin
          const selectedGender = $("input[name='gender']:checked");
          if (!selectedGender.length > 0) {
            alert("Jenis kelamin harus dipilih");
            event.preventDefault();
            return;
          }

          // Validasi agama
          const agama = $("#agama").val();
          if (!agama) {
            alert("Agama tidak boleh kosong");
            event.preventDefault();
            return;
          }

          // Validasi status
          const status = $("#status").val();
          if (!status) {
            alert("Status tidak boleh kosong");
            event.preventDefault();
            return;
          }

          // Validasi alamat
          const alamat = $("#alamat").val();
          if (!alamat) {
            alert("Alamat tidak boleh kosong");
            event.preventDefault();
            return;
          }

          // Validasi nomor telepon
          const noTelp = $("#no-telp").val();
          if (!noTelp) {
            alert("Nomor telepon tidak boleh kosong");
            event.preventDefault();
            return;
          }

          // Validasi password
          const password = $("#password").val();
          const confirmPassword = $("#confirm").val();

          // Minimum 8 karakter, setidaknya 1 huruf kapital, 1 angka, dan 1 simbol
          const passwordRegex =
            /^(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

          if (!passwordRegex.test(password)) {
            alert(
              "Password harus memenuhi persyaratan: minimal 8 karakter, setidaknya 1 huruf kapital, 1 angka, dan 1 simbol"
            );
            event.preventDefault();
            return;
          }

          // Cek apakah password dan konfirmasi password sesuai
          if (password !== confirmPassword) {
            alert("Password dan konfirmasi password tidak cocok");
            event.preventDefault();
            return;
          }
        });
      });
    </script>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm text-center">
          <h1>Selamat Datang Kembali</h1>
          <p>
            Untuk tetap terhubung dengan kami, silahkan masuk dengan akun anda
          </p>
          <a class="btn btn-primary" href="/login">Sign In</a>
        </div>
        <div class="col">
          <h1 class="text-center mb-5">Buat Akun</h1>
          <form action="/api/register" method="post" id="registrationForm">
            <div class="row mb-3">
              <label
                for="username"
                class="col-sm-2 col-form-label col-form-label-sm"
                >Username
              </label>
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control form-control-sm"
                  id="username"
                  name="username"
                />
              </div>
            </div>
            <div class="row mb-3">
              <label
                for="name"
                class="col-sm-2 col-form-label col-form-label-sm"
                >Nama
              </label>
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control form-control-sm"
                  id="name"
                  name="name"
                />
              </div>
            </div>
            <div class="row mb-3">
              <label for="nik" class="col-sm-2 col-form-label col-form-label-sm"
                >NIK
              </label>
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control form-control-sm"
                  id="nik"
                  name="nik"
                />
              </div>
            </div>
            <div class="row mb-3">
              <label
                for="tgl-lahir"
                class="col-sm-2 col-form-label col-form-label-sm"
                >Tgl Lahir
              </label>
              <div class="col-sm-10">
                <input
                  type="date"
                  class="form-control form-control-sm"
                  id="tgl-lahir"
                  name="tgl-lahir"
                />
              </div>
            </div>
            <div class="row mb-3">
              <label
                for="gender"
                class="col-sm-2 col-form-label col-form-label-sm"
                >Jenis Kelamin</label
              >
              <div class="col-sm-10">
                <div class="form-check form-check-inline">
                  <input
                    type="radio"
                    class="form-check-input"
                    id="gender-laki"
                    name="gender"
                    value="laki-laki"
                  />
                  <label class="form-check-label" for="gender-laki"
                    >Laki-Laki</label
                  >
                </div>
                <div class="form-check form-check-inline">
                  <input
                    type="radio"
                    class="form-check-input"
                    id="gender-perempuan"
                    name="gender"
                    value="perempuan"
                  />
                  <label class="form-check-label" for="gender-perempuan"
                    >Perempuan</label
                  >
                </div>
              </div>
            </div>
            <div class="row mb-3">
              <label
                for="agama"
                class="col-sm-2 col-form-label col-form-label-sm"
                >Agama
              </label>
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control form-control-sm"
                  id="agama"
                  name="agama"
                />
              </div>
            </div>
            <div class="row mb-3">
              <label
                for="status"
                class="col-sm-2 col-form-label col-form-label-sm"
                >Status
              </label>
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control form-control-sm"
                  id="status"
                  name="status"
                />
              </div>
            </div>
            <div class="row mb-3">
              <label
                for="alamat"
                class="col-sm-2 col-form-label col-form-label-sm"
                >Alamat
              </label>
              <div class="col-sm-10">
                <input
                  type="text"
                  class="form-control form-control-sm"
                  id="alamat"
                  name="alamat"
                />
              </div>
            </div>
            <div class="row mb-3">
              <label
                for="no-telp"
                class="col-sm-2 col-form-label col-form-label-sm"
                >No Telp
              </label>
              <div class="col-sm-10">
                <input
                  type="tel"
                  class="form-control form-control-sm"
                  id="no-telp"
                  name="no-telp"
                  pattern="\d{10,13}"
                />
              </div>
            </div>
            <div class="row mb-3">
              <label
                for="password"
                class="col-sm-2 col-form-label col-form-label-sm"
                >Password
              </label>
              <div class="col-sm-10">
                <input
                  type="password"
                  class="form-control form-control-sm"
                  id="password"
                  name="password"
                />
              </div>
            </div>
            <div class="row mb-3">
              <label
                for="confirm"
                class="col-sm-2 col-form-label col-form-label-sm"
                >Confirm Password
              </label>
              <div class="col-sm-10">
                <input
                  type="password"
                  class="form-control form-control-sm"
                  id="confirm"
                  name="confirm"
                />
              </div>
            </div>
            <div class="d-grid d-md-flex justify-content-center">
              <button class="btn btn-primary" type="submit">Sign Up</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </body>
</html>
