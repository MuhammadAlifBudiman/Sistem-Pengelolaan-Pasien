<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kelola Praktik</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css')}}"
    />
    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <!-- DataTables CSS -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css"
    />
    <!-- DataTables JS -->
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"
    ></script>
  </head>
  <script>
    // Jadwal Table
    $(document).ready(function () {
      // Inisialisasi DataTables
      let myTable = $("#pendaftaranTable").DataTable();
      let checkupTable = $("#checkupTable").DataTable();
      let rekamMedisTable = $("#rekamMedisTable").DataTable();
      let list_checkup_user = $("#list_checkup_user").DataTable();

      // Ambil data riwayat pendaftaran
      $.ajax({
        url: "/api/dashboard_pendaftaran",
        type: "GET",
        success: function (data) {
          // Isi tabel riwayat pendaftaran
          myTable.clear().draw();
          data.data_list_pendaftaran.forEach(function (row, index) {
            let antrian = row.antrian || "-";
            myTable.row
              .add([antrian, row.name, row.poli, row.tanggal, row.status])
              .draw(false);
          });
        },
      });

      // Ambil data riwayat pendaftaran
      $.ajax({
        url: "/api/dashboard_checkup",
        type: "GET",
        success: function (data) {
          console.log(data);
          // Isi tabel riwayat pendaftaran
          checkupTable.clear().draw();
          data.data_list_checkup.forEach(function (row, index) {
            checkupTable.row
              .add([
                index + 1,
                row.tgl_periksa,
                row.nama,
                row.dokter,
                row.poli,
                row.keluhan,
                row.hasil_anamnesa,
              ])
              .draw(false);
          });
        },
      });

      // Ambil data riwayat pendaftaran
      $.ajax({
        url: "/api/dashboard_rekam_medis",
        type: "GET",
        success: function (data) {
          console.log(data);
          // Isi tabel riwayat pendaftaran
          rekamMedisTable.clear().draw();
          data.data_list_rekam_medis.forEach(function (row, index) {
            rekamMedisTable.row
              .add([
                index + 1,
                row.nik,
                row.nama,
                "<button class='btn btn-primary btn-lihat' data-bs-toggle='modal' data-bs-target='#lihatModal'>Lihat</button>",
              ])
              .draw(false);
          });
        },
      });

      $("#rekamMedisTable").on("click", ".btn-lihat", function (e) {
        e.preventDefault();
        console.log("lihat");
        let row = rekamMedisTable.row($(this).parents("tr"));
        let rowData = row.data();
        console.log(rowData);
        let nik = rowData[1];

        $.ajax({
          url: `/lihat_rekam_medis/${nik}`,
          type: "GET",
          success: function (response) {
            // Update tabel
            console.log(response.list_checkup_user);
            list_checkup_user.clear().draw();
            for (let i = 0; i < response.list_checkup_user.length; i++) {
              let newRow = [
                i + 1,
                response.list_checkup_user[i].tgl_periksa,
                response.list_checkup_user[i].dokter,
                response.list_checkup_user[i].poli,
                response.list_checkup_user[i].keluhan,
                response.list_checkup_user[i].hasil_anamnesa,
              ];
              let rowNode = list_checkup_user.row.add(newRow).draw().node();
              $(rowNode).attr("id", response.list_checkup_user[i]._id);
            }
          },
          error: function (error) {
            console.log("Error:", error);
          },
        });
      });
    });

    $(".navbar-toggler").on("click", function () {
      $(".navbar-collapse").toggleClass("show");
    });

    function sign_out() {
      $.removeCookie("mytoken", { path: "/" });
      alert("Logged out!");
      window.location.href = "/";
    }
  </script>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
      <a class="navbar-brand ms-4" style="color: #06a3da"
        ><span style="color: #091e3e">Klinik</span> Google</a
      >
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/kelola_pendaftaran">Pendaftaran</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link active" href="/dashboard">Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/rekam_medis">Rekam Medis</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="kelola_praktik">Kelola Praktek</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/profile">{{ user_info.username }}</a>
          </li>
          <li class="nav-item">
            <button
              class="btn text-light"
              onclick="sign_out()"
              style="background-color: #f57e57"
            >
              Logout
            </button>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container mt-5">
      <h2 id="jadwal" class="text-center" style="color: #091e3e">Dasbord</h2>
      <h2 id="jadwal" class="text-center" style="color: #091e3e">
        Pendaftaran
      </h2>
      <table
        class="table table-hover table-bordered"
        style="border-collapse: collapse; border-color: #091e3e"
        id="pendaftaranTable"
      >
        <thead>
          <tr>
            <th>No Urut</th>
            <th>Nama</th>
            <th>Poli</th>
            <th>Tanggal Periksa</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data will be populated here -->
        </tbody>
      </table>
      <h2 id="checkup" class="text-center mt-5" style="color: #091e3e">
        Check Up
      </h2>
      <table
        class="table table-hover table-bordered"
        style="border-collapse: collapse; border-color: #091e3e"
        id="checkupTable"
      >
        <thead>
          <tr>
            <th>No</th>
            <th>Tanggal Periksa</th>
            <th>Nama Pasien</th>
            <th>Nama Dokter</th>
            <th>Poli</th>
            <th>Keluhan</th>
            <th>Hasil Pemeriksaan</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data will be populated here -->
        </tbody>
      </table>
      <h2 id="rekam_medis" class="text-center mt-5" style="color: #091e3e">
        Rekam Medis
      </h2>
      <table
        class="table table-hover table-bordered"
        style="border-collapse: collapse; border-color: #091e3e"
        id="rekamMedisTable"
      >
        <thead>
          <tr>
            <th>No</th>
            <th>NIK</th>
            <th>Nama Pasien</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data will be populated here -->
        </tbody>
      </table>
    </div>

    <!-- lihat Modal -->
    <div
      class="modal fade"
      id="lihatModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="lihatModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-fullscreen" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="lihatModalLabel">Hasil Periksa</h2>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <table class="table" id="list_checkup_user">
              <thead>
                <tr>
                  <th>No</th>
                  <th>Tgl Periksa</th>
                  <th>Dokter</th>
                  <th>Poli</th>
                  <th>Keluhan</th>
                  <th>Anamnesa Hasil Pemeriksaan</th>
                </tr>
              </thead>
            </table>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div
      class="footer text-left mt-5 py-5"
      style="background-color: #091e3e; color: #fff"
    >
      <div class="container">
        <div class="row">
          <div class="col-md-6 mx-auto">
            <h3 style="font-weight: bold; color: #06a3da">Contact Us</h3>
            <p class="mb-2">
              <i class="bi bi-geo-alt text-primary me-2"></i>Jalan Supratman No.
              123, Bandung, Jawa Barat
            </p>
            <p class="mb-2">
              <i class="bi bi-envelope-open text-primary me-2"></i
              >KlinikGoggle@email.com
            </p>
            <p class="mb-0">
              <i class="bi bi-telephone text-primary me-2"></i>+628 2345 67890
            </p>
          </div>
          <div class="col-md-6 mx-auto">
            <h3 style="font-weight: bold; color: #06a3da">Follow Us</h3>
            <div class="d-flex">
              <a
                class="btn btn-lg btn-primary btn-lg-square rounded me-2"
                href="#"
                ><i class="fab fa-twitter fw-normal"></i
              ></a>
              <a
                class="btn btn-lg btn-primary btn-lg-square rounded me-2"
                href="#"
                ><i class="fab fa-facebook-f fw-normal"></i
              ></a>
              <a
                class="btn btn-lg btn-primary btn-lg-square rounded me-2"
                href="#"
                ><i class="fab fa-linkedin-in fw-normal"></i
              ></a>
              <a class="btn btn-lg btn-primary btn-lg-square rounded" href="#"
                ><i class="fab fa-instagram fw-normal"></i
              ></a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid text-light py-4" style="background: #051225">
      <div class="container">
        <div class="row g-0">
          <div class="col-md-6 mx-auto text-center">
            <p class="mb-md-0">
              &copy;
              <a class="text-white border-bottom" href="#">Klinik Google</a>.
              All Rights Reserved.
            </p>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
